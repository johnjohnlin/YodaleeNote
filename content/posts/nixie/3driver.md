---
title: "自幹世界線變動率探測儀（Nixie Tube Clock）：驅動電路"
date: 2018-10-21
categories:
- hardware
tags:
- Hardware
- NixieClock
series:
- 自幹世界線變動率探測儀(Nixie Tube Clock)
---

有了高壓電源之後下一步是驅動電路，如何控制 180 伏特的高壓電源開關？  
<!--more-->

查資料的時候發現[有些人](https://home.gamer.com.tw/creationDetail.php?sn=1632662)是用 TLP521 光耦合器，不過我看 spec 之後是不建議用這顆，第一是它很貴，光華商場一顆單價 15 元，甚至有 30 元的；第二是它 VCEO 只有 55 V，實測的時候 TLP521 關掉還是會吃到 130 V，遠超過 VCEO，實際上是沒有怎麼樣，但不知道用久了會不會有問題，到如壽命減短，或是漏電愈來愈大最後關不住之類，搞不好也是沒有問題只是多漏一點電。  
我個人是保險一點，同樣參考[復古咖啡](https://fugu.cafe/talks/7663)，用 MPSA42 跟 MPSA92 兩顆對稱的高壓 BJT 來控制，這兩顆單價只要 3 元，便宜得多，耐壓高達 300 V 絕對夠。  

設計的部分我基本上和復古咖啡是一樣的，下圖分別是控制接地的 NPN 跟控制高壓的 PNP：  
![cathode](/images/nixie/cathode.png)
陰極驅動的 MPSA42 比較簡單，控制接基極，就可以控制集極的電流。   
![anode](/images/nixie/anode.png)
MPSA92 要搭配另一個 MPSA42，MPSA42 是關的時候，MPSA92 基極會由 1M 的電阻拉到 180 V 而關閉，打開 MPSA42 就會讓 MPSA 打開，把集極拉到高壓。    
驅動電阻的部分，在陰極驅動的地方，要驅動的電流是 1.5 mA，MPSA42 的 β 值大約是 50-100，保守一點算 50 基極電流只需要 0.03 mA 就夠了，加上我用的控制器 ATmega328p 的驅動電壓又是 5V 而不是 3.3V，扣掉 Vbe = 0.9V，用 100K 的電阻就足夠打開 MPSA42 了，我在設計上是用 51K 的電阻；陽極驅動電路也是，只要驅動 0.38 mA 的電流的話，電阻用到 500K 都沒有問題，我為了採購方便還是買 51K 的電阻就是。  

高壓的部分有些人也許買得到蘇聯制的K155ID1 之類的高壓 BCD to decimal 驅動 IC 之類的也是可以，但我是覺得沒什麼必要，一方面它也只是個 BCD-to-Decimal 的晶片，要控制小數點還是要靠高壓 BJT，而且要買個 K155ID1 也不容易，不像高壓 BJT 電子零件行隨便買，這也是難得 IC 反過來被離散元件取代的地方呢。  

IN14 操作的電流是 1.5 mA 左右，限流電阻大約是 22k；左、右小數點的限流電阻則是 75k 左右，所以我是在陽極上一顆共用的 22k 電阻，左、右小數點的陰極加上一顆 51k 的電阻，schematic 畫起來像這樣：  
![tube](/images/nixie/tube.png)
74HC238 跟 74CD4514 （如果有 74HC4514 當然是最好啦）是網路上搜尋找到的邏輯閘，分別是 3-8 demultiplexer 跟 4-16 demultiplexer，要注意他們跟 HC138，HC4515 很像，但其實完全不一樣，一個是選到的輸出 high 一個是 low，小心不要買錯了。  

另外還有一部份是操控 LED 的驅動電路，現下流行在管子下面放 LED 打光，看起來就會很潮，潮到發光(X。  
LED的部分我是選用 5050 RBG SMD LED，也可以用 3528 尺寸會比較小，參考 5050 的電路圖，RGB 分別要接 270, 680, 270 歐姆的限流電阻，測試的電流我記得是 10 mA 左右，不必到規格要求的 20 mA，就已經可以發出滿亮的光了（而且綠色的特亮，為了讓它暗一點才把電阻調大了），真的要 20 mA 的話電阻可能會小到 180 歐姆左右，我在想那個光度應該足以閃瞎人的眼睛，甚至現在這個亮度我都覺得太亮，可以再選大一點的電阻。  

另外還有一個問題是控制的驅動能力，因為我們選用的控制 IC ATmega328p，數位 Pin 腳的電流最大只有 40 mA ，總和最大是 200 mA，一支腳位不太可能驅動得了 8 個 LED，我們也不可能生得出 8 支 Pin 腳來控制 LED。  
在這裡我們選用簡單的 NPN 2N2222 控制大電流，參照 datasheet，在我們的條件下，2N2222 的電流增益可以到 100-200，基極只需要大概 1-2 mA 就夠了，用 2.2k 的限流電阻應該非常安全，用到 5 K 左右也還是 OK 的，用 2.2k 單純因為控制電路那邊有 2.2k 的可以用，一起買比較方便。
![led](/images/nixie/led.png)
